<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.pkaq.web.jxc.instock.mapper.InstockMapper">
    <resultMap id="BaseResultMap" type="instock" extends="common.resultMap">
        <result column="INDATE" jdbcType="DATE" property="indate" />
        <result column="INCODE" jdbcType="VARCHAR" property="incode" />
        <result column="TITLE" jdbcType="VARCHAR" property="title" />
    </resultMap>
    <!-- 带子表数据查询 -->
    <resultMap id="LineResultMap" type="instock" extends="BaseResultMap">
        <collection property="line" ofType="org.pkaq.web.jxc.instock.entity.InstockLineEntity" column="{mainId=id}"
                    select="org.pkaq.web.jxc.instock.mapper.InstockLineMapper.listByMainId"/>
    </resultMap>

    <!-- 查询库存 -->
        <select id="listInstock" parameterType="org.pkaq.web.jxc.instock.vo.InstockVO" resultMap="LineResultMap">
        select * from t_jxc_instock t
            left join t_jxc_instock_line t1
                      on t.id = t1.MAIN_ID
        <where>
            <if test="null != instockVO.indate">
                t.indate = #{instockVO.indate}
            </if>
            <if test="null != instockVO.incode and '' != instockVO.incode">
                and t.incode = #{instockVO.incode}
            </if>
            <if test="null != instockVO.buynum">
                and t1.buynum = #{instockVO.buynum}
            </if>
            <if test="null != instockVO.buyprice">
                and t1.buyprice = #{instockVO.buyprice}
            </if>
            <if test="null != instockVO.barcode and '' != instockVO.barcode">
                and t1.barcode like CONCAT('%','${instockVO.barcode}','%' )
            </if>
            <if test="null != instockVO.name">
                and t1.name like CONCAT('%','${instockVO.name}','%' )
            </if>
            <if test="null != instockVO.category and '' != instockVO.category">
                and t1.category = #{instockVO.category}
            </if>
            <if test="null != instockVO.unit and '' != instockVO.unit">
                and t1.unit = #{instockVO.unit}
            </if>
            <if test="null != instockVO.model and '' != instockVO.model">
                and t1.model like CONCAT('%','${instockVO.model}','%' )
            </if>
            <if test="null != instockVO.mnemonic and '' != instockVO.mnemonic">
                and t1.mnemonic like CONCAT('%','${instockVO.mnemonic}','%' )
            </if>
            <if test="null != instockVO.supplier and '' != instockVO.supplier">
                and t1.supplier like CONCAT('%','${instockVO.supplier}','%' )
            </if>
        </where>
        order by t.indate desc
    </select>
</mapper>