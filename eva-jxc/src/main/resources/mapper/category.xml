<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.module//DTD Mapper 3.0//EN" "http://mybatis.module/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.nerv.web.jxc.base.category.mapper.CategoryMapper">
    <resultMap id="BaseResultMap" type="jxc_category" extends="common.resultMap">
        <result column="CODE" jdbcType="VARCHAR" property="code" />
        <result column="NAME" jdbcType="VARCHAR" property="name" />
        <result column="PARENT_ID" jdbcType="VARCHAR" property="parentId" />
        <result column="PARENT_NAME" jdbcType="VARCHAR" property="parentName" />
        <result column="PATH" jdbcType="VARCHAR" property="path" />
        <result column="PATH_ID" jdbcType="VARCHAR" property="pathId" />
        <result column="PATH_NAME" jdbcType="VARCHAR" property="pathName" />
        <result column="ISLEAF" jdbcType="TINYINT" property="isleaf" />
        <result column="ORDERS" jdbcType="INTEGER" property="orders" />
        <result column="STATUS" jdbcType="VARCHAR" property="status" />
        <collection property="children"  column="{id=id,status=status}" select="listChildren" />
    </resultMap>
    <!--根据条件查询菜单数据-->
    <select id="listCategory" resultMap="BaseResultMap">
        select * from jxc_base_category
        <where>
            <choose>
                <when test="null == condition or '' == condition">
                    (parent_Id = '0' or parent_Id is null)
                </when>
                <otherwise>
                    name like '%${condition}%'
                </otherwise>
            </choose>
            <if test="null != category">
                <if test="category.status != '' and null != category.status">
                    and status = #{category.status}
                </if>
                <if test="category.name != '' and null != category.name">
                    and name = #{category.name}
                </if>
            </if>
        </where>
        order by orders, gmt_Create asc
    </select>
    <!-- 根据parentId查询子节点数据-->
    <select id="listChildren" resultMap="BaseResultMap">
        select * from jxc_base_category
        <where>
            parent_ID = #{id}
            <if test="status != '' and null != status">
                and status = #{status}
            </if>
        </where>
        order by orders asc
    </select>
     <!--根据ID查询-->
    <select id="getParentById" resultMap="BaseResultMap">
        select * from jxc_base_category module
        where module.id = (select parent_Id from jxc_base_category og where og.id = #{id})
    </select>
    <!--查询叶子节点数量-->
    <select id="countPrantLeaf" resultType="int">
        select count(id)
        from jxc_base_category
        where parent_Id=(select parent_Id from jxc_base_category og where og.id = #{id})
    </select>

</mapper>