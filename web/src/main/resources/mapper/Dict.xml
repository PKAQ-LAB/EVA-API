<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.pkaq.web.sys.dict.mapper.DictMapper">
  <resultMap id="BaseResultMap" type="dict">
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="code" jdbcType="VARCHAR" property="code" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="parentID" jdbcType="VARCHAR" property="parentid" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="status" jdbcType="TINYINT" property="status" />
    <result column="gmt_create" jdbcType="TIMESTAMP" property="gmtCreate" />
    <result column="gmt_modify" jdbcType="TIMESTAMP" property="gmtModify" />
    <result column="create_by" jdbcType="VARCHAR" property="createBy" />
    <result column="modify_by" jdbcType="VARCHAR" property="modifyBy" />
  </resultMap>
  <!-- 树形数据 -->
  <resultMap id="TreeResultMap" type="dict" extends="BaseResultMap">
    <collection property="children"  column="{id=id}" select="listChildren" />
  </resultMap>
  <!-- 带子表数据查询 -->
  <resultMap id="LineResultMap" type="dict" extends="BaseResultMap">
      <collection property="items"  ofType="dictItem">
          <id column="itemId" property="id"/>
          <result column="MAIN_ID" jdbcType="VARCHAR" property="mainId" />
          <result column="key_name" jdbcType="VARCHAR" property="keyName" />
          <result column="key_value" jdbcType="VARCHAR" property="keyValue" />
          <result column="orders" jdbcType="INTEGER" property="orders" />
          <result column="status" jdbcType="VARCHAR" property="status" />
          <result column="remark" jdbcType="VARCHAR" property="remark" />
      </collection>
  </resultMap>
  <sql id="column">
      m.id,m.code,m.name,m.parentID,m.remark,
      m2.id itemId ,m2.main_id,m2.key_name,m2.key_value,m2.orders,m2.status,m2.remark
  </sql>
  <select id="getDict" resultMap="LineResultMap">
      select
      <include refid="column"/>
      from sys_dict m LEFT JOIN sys_dict_item m2 on m.id = m2.main_id
      where m.id = #{id}
      order by m2.orders
  </select>
  <!--根据条件查询菜单数据-->
  <select id="listDict" resultMap="TreeResultMap">
    select * from sys_dict
    <where>
      parentID = '0' or parentID is null and status !=0
    </where>
  </select>
  <!-- 根据parentId查询子节点数据-->
  <select id="listChildren" resultMap="BaseResultMap">
    select * from sys_dict where parentID = #{id}  and status !=0
  </select>
  <!-- 根据条件删除字典项 -->
  <update id="deleteDictById">
      update sys_dict set status = 0 where id = #{id}
  </update>
</mapper>