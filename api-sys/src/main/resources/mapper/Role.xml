<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.nerv.web.sys.role.mapper.RoleMapper">
  <resultMap id="BaseResultMap" type="role" extends="common.resultMap">
    <result column="NAME" jdbcType="VARCHAR" property="name" />
    <result column="CODE" jdbcType="VARCHAR" property="code" />
    <result column="PARENT_ID" jdbcType="VARCHAR" property="parentId" />
    <result column="PARENT_NAME" jdbcType="VARCHAR" property="parentName" />
    <result column="PATH" jdbcType="VARCHAR" property="path" />
    <result column="PATH_NAME" jdbcType="VARCHAR" property="pathName" />
    <result column="ISLEAF" jdbcType="TINYINT" property="isleaf" />
    <result column="ORDERS" jdbcType="INTEGER" property="orders" />
    <result column="LOCKED" jdbcType="TINYINT" property="locked" />
  </resultMap>
  <!-- 根据userId获取 权限相关信息-->
  <select id="selectByUserId" resultType="role">
    select R.ID,R.NAME,R.CODE,RU.USER_ID
      from SYS_ROLE R, SYS_ROLE_USER RU
    <where>
        R.ID= RU.ROLE_ID
        and
        R.LOCKED=0
        and
        RU.USER_ID=#{userId}
    </where>
  </select>

    <!-- 根据查询条件获取该account的角色-->
    <select id="selectRoleByUserId"  resultMap="BaseResultMap">
        select R.*
        from SYS_ROLE R, SYS_ROLE_USER RU,sys_user_info sui
        <where>
            R.ID= RU.ROLE_ID
            and
            RU.User_ID=sui.id
            and
            R.LOCKED=0
            and
            sui.account=#{account}
            <if test="@cn.hutool.core.util.StrUtil@isNotBlank(entity.id)">
                and R.ID=#{entity.id}
            </if>
            <if test="@cn.hutool.core.util.StrUtil@isNotBlank(entity.name)">
                and R.NAME like concat('%',#{entity.name},'%')
            </if>
            <if test="@cn.hutool.core.util.StrUtil@isNotBlank(entity.code)">
                and R.CODE=#{entity.code}
            </if>
        </where>
    </select>
</mapper>