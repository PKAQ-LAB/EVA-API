<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.pkaq.web.sys.organization.mapper.OrganizationMapper">
  <resultMap id="BaseResultMap" type="orginization" extends="common.resultMap">
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="code" jdbcType="VARCHAR" property="code" />
    <result column="parentID" jdbcType="VARCHAR" property="parentid" />
    <result column="parentName" jdbcType="VARCHAR" property="parentname" />
    <result column="path" jdbcType="VARCHAR" property="path" />
    <result column="pathname" jdbcType="VARCHAR" property="pathname" />
    <result column="isleaf" jdbcType="TINYINT" property="isleaf" />
    <result column="orders" jdbcType="INTEGER" property="orders" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <collection property="children"  column="{id=id,status=status}" select="listChildren" />
  </resultMap>
  <!--根据条件查询菜单数据-->
   <select id="listOrg" resultMap="BaseResultMap">
       select * from sys_orginization
       <where>
        <choose>
          <when test="null == condition or '' == condition">
            parentID = '0' or parentID is null
          </when>
          <otherwise>
            name like '%${condition}%' or code like '%${condition}%'
          </otherwise>
        </choose>
       <if test="null != organization">
           <if test="organization.status != '' and null != organization.status">
               and status = #{organization.status}
           </if>
       </if>
       </where>
       order by orders asc
   </select>
  <!-- 根据parentId查询子节点数据-->
  <select id="listChildren" resultMap="BaseResultMap">
    select *
      from sys_orginization where parentID = #{id}
      <if test="null != organization">
          <if test="status != '' and null != status">
              and status = #{organization.status}
          </if>
      </if>
    order by orders asc
  </select>
  <!-- 根据ID查询-->
  <select id="getParentById" resultMap="BaseResultMap">
      select * from sys_orginization org
      where org.id = (select parentid from sys_orginization og where og.id = #{id})
  </select>

  <select id="countPrantLeaf" resultType="int">
      select count(id)
      from sys_orginization
      where parentID=(select parentid from sys_orginization og where og.id = #{id})
  </select>
</mapper>